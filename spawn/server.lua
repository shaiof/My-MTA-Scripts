countryNames = {
    ["IT"]="Italy",
    ["MX"]="Mexico",
    ["SA"]="SAUDI ARBIA",
    ["PK"]="Pakistan",
    ["AF"]="Afghanistan",
    ["DZ"]="Algeria",
    ["AS"]="American samoa",
    ["AU"]="Australlia",
    ["AO"]="Anqola",
    ["AI"]="Anquilla",
    ["AQ"]="Antarctica",
    ["AG"]="Antigua and Barbuda",
    ["AR"]="Argentina",
    ["AM"]="Armenia",
    ["AW"]="Aruba",
    ["AT"]="Austria",
    ["AZ"]="Azerbaijan",
    ["BS"]="Bahamas",
    ["BH"]="Bahrain",
    ["BD"]="Bangladesh",
    ["BB"]="Barbados",
    ["BY"]="Belarus",
    ["BE"]="Belgium",
    ["BZ"]="Belize",
    ["BJ"]="Benin",
    ["BM"]="Bermuda",
    ["BT"]="Bhutan",
    ["BO"]="Bolivia",
    ["BA"]="Bosnia",
    ["BH"]="Herzegovina",
    ["BW"]="Botswana",
    ["BR"]="Brazil",
    ["IO"]="British Indian Ocean Territory",
    ["VG"]="British Virgin Islands",
    ["BN"]="Brunei",
    ["BG"]="Bulgaria",
    ["BF"]="Burkina Faso",
    ["MM"]="Burma (Myanmar)",
    ["BI"]="Burundi",
    ["KH"]="Cambodia",
    ["CM"]="Cameroon",
    ["CA"]="Canada",
    ["CV"]="Cape Verde",
    ["KY"]="Cayman Islands",
    ["CF"]="Central African Republic",
    ["TD"]="Chad",
    ["CL"]="Chile",
    ["CN"]="China",
    ["CX"]="Christmas Island",
    ["CC"]="Cocos (Keeling) Islands",
    ["CO"]="Colombia",
    ["KM"]="Comoros",
    ["CK"]="Cook Islands",
    ["CR"]="Costa Rica",
    ["HR"]="Croatia",
    ["CU"]="Cuba",
    ["CY"]="Cyprus",
    ["CZ"]="Czech Republic",
    ["CD"]="Democratic Republic of the Congo",
    ["DK"]="Denmark",
    ["DJ"]="Djibouti",
    ["DM"]="Dominica",
    ["DO"]="Dominican Republic",
    ["EC"]="Ecuador",
    ["SV"]="El Salvador",
    ["GQ"]="Equatorial Guinea",
    ["ER"]="Eritrea",
    ["EE"]="Estonia",
    ["ET"]="Ethiopia",
    ["FK"]="Falkland Islands",
    ["FO"]="Faroe Islands",
    ["FJ"]="Fiji",
    ["FI"]="Finland",
    ["FR"]="France",
    ["PF"]="French Polynesia",
    ["GA"]="Gabon",
    ["GM"]="Gambia",
    ["GE"]="Georgia",
    ["DE"]="Germany",
    ["GH"]="Ghana",
    ["GI"]="Gibraltar",
    ["GR"]="Greece",
    ["GL"]="Greenland",
    ["GD"]="Grenada",
    ["GU"]="Guam",
    ["GT"]="Guatemala",
    ["GN"]="Guinea",
    ["GW"]="Guinea-Bissau",
    ["GY"]="Guyana",
    ["HT"]="Haiti",
    ["VA"]="Holy See (Vatican City)",
    ["HN"]="Honduras",
    ["HK"]="Hong Kong",
    ["HU"]="Hungary",
    ["IS"]="Iceland",
    ["IN"]="India",
    ["ID"]="Indonesia",
    ["IR"]="Iran",
    ["IQ"]="Iraq",
    ["IE"]="Ireland",
    ["IM"]="Isle of Man",
    ["IL"]="Israel",
    ["IT"]="Italy",
    ["CI"]="Ivory Coast",
    ["JM"]="Jamaica",
    ["JP"]="Japan",
    ["JE"]="Jersey",
    ["JO"]="Jordan",
    ["KZ"]="Kazakhstan",
    ["KE"]="Kenya",
    ["KI"]="Kiribati",
    ["KO"]="Kosovo",
    ["KW"]="Kuwait",
    ["KG"]="Kyrgyzstan",
    ["LA"]="Laos",
    ["LV"]="Latvia",
    ["LB"]="Lebanon",
    ["LS"]="Lesotho",
    ["LR"]="Liberia",
    ["LY"]="Libya",
    ["LI"]="Liechtenstein",
    ["LT"]="Lithuania",
    ["LU"]="Luxembourg",
    ["MO"]="Macau",
    ["MK"]="Macedonia",
    ["MG"]="Madagascar",
    ["MW"]="Malawi",
    ["MY"]="Malaysia",
    ["MV"]="Maldives",
    ["ML"]="Mali",
    ["MT"]="Malta",
    ["MH"]="Marshall Islands",
    ["MR"]="Mauritania",
    ["MU"]="Mauritius",
    ["YT"]="Mayotte",
    ["MX"]="Mexico",
    ["FM"]="Micronesia",
    ["MD"]="Moldova",
    ["MC"]="Monaco",
    ["MN"]="Mongolia",
    ["ME"]="Montenegro",    
    ["MS"]="Montserrat",
    ["MA"]="Morocco",
    ["MZ"]="Mozambique",
    ["NA"]="Namibia",
    ["NR"]="Nauru",
    ["NP"]="Nepal",
    ["NL"]="Netherlands",
    ["AN"]="Netherlands Antilles",
    ["NC"]="New Caledonia",
    ["NZ"]="New Zealand",
    ["NI"]="Nicaragua",
    ["NE"]="Niger",
    ["NG"]="Nigeria",
    ["NU"]="Niue",
    ["NI"]="Norfolk Island",
    ["KP"]="North Korea",
    ["MP"]="Northern Mariana Islands",
    ["NO"]="Norway",
    ["OM"]="Oman",
    ["PK"]="Pakistan",
    ["PW"]="Palau",
    ["PA"]="Panama",
    ["PG"]="Papua New Guinea",
    ["PY"]="Paraguay",
    ["PE"]="Peru",
    ["PH"]="Philippines",
    ["PN"]="Pitcairn Islands",
    ["PL"]="Poland",
    ["PT"]="Portugal",
    ["PR"]="Puerto Rico",
    ["QA"]="Qatar",
    ["CG"]="Republic of the Congo",
    ["RO"]="Romania",
    ["RU"]="Russia",
    ["RW"]="Rwanda",
    ["BL"]="Saint Barthelemy",
    ["SH"]="Saint Helena",
    ["KN"]="Saint Kitts and Nevis",
    ["LC"]="Saint Lucia",
    ["MF"]="Saint Martin",
    ["PM"]="Saint Pierre and Miquelon",
    ["VC"]="Saint Vincent and the Grenadines",
    ["WS"]="Samoa",
    ["SM"]="San Marino",
    ["ST"]="Sao Tome and Principe",
    ["SA"]="Saudi Arabia",
    ["SN"]="Senegal",
    ["RS"]="Serbia",
    ["SC"]="Seychelles",
    ["SL"]="Sierra Leone",
    ["SG"]="Singapore",
    ["SK"]="Slovakia",
    ["SI"]="Slovenia",
    ["SB"]="Solomon Islands",
    ["SO"]="Somalia",
    ["ZA"]="South Africa",
    ["KR"]="South Korea",
    ["ES"]="Spain",
    ["LK"]="Sri Lanka",
    ["SD"]="Sudan",
    ["SR"]="Suriname",
    ["SJ"]="Svalbard",
    ["SZ"]="Swaziland",
    ["SE"]="Sweden",
    ["CH"]="Switzerland",
    ["SY"]="Syria",
    ["TW"]="Taiwan",
    ["TJ"]="Tajikistan",
    ["TZ"]="Tanzania",
    ["TH"]="Thailand",
    ["TL"]="Timor-Leste",
    ["TG"]="Togo",
    ["TK"]="Tokelau",
    ["TO"]="Tonga",
    ["TT"]="Trinidad and Tobago",
    ["TN"]="Tunisia",
    ["TR"]="Turkey",
    ["TM"]="Turkmenistan",
    ["TC"]="Turks and Caicos Islands",
    ["TV"]="Tuvalu",
    ["UG"]="Uganda",
    ["UA"]="Ukraine",
    ["AE"]="United Arab Emirates",
    ["GB"]="United Kingdom",
    ["US"]="United States",
    ["UY"]="Uruguay",
    ["VI"]="US Virgin Islands",
    ["UZ"]="Uzbekistan",
    ["VU"]="Vanuatu",
    ["VE"]="Venezuela",
    ["VN"]="Vietnam",
    ["WF"]="Wallis and Futuna",
    ["WB"]="West Bank",
    ["EH"]="Western Sahara",
    ["YE"]="Yemen",
    ["ZM"]="Zambia",
    ["ZW"]="Zimbabwe"
}

addEventHandler("onElementDataChange",getRootElement(),
    function ( ElementData )
        if ( ElementData == "Last Drift" ) then
            givePlayerMoney(source,getElementData(source,ElementData) / 50)
    end
end)

function rewardOnWasted ( ammo, killer, killerweapon, bodypart )
	if ( killer ) and ( killer ~= source ) then 
		givePlayerMoney ( killer, 1000 )
	end
end
addEventHandler ( "onPlayerWasted", getRootElement(), rewardOnWasted )


function gc(player,cmd,tele)
	if (isPedInVehicle(player) == true) then
		if getPedOccupiedVehicle(player) and getPedOccupiedVehicleSeat(player) == 0 then
			local occupiedCar = getPedOccupiedVehicle(player)
			local x,y,z = getElementPosition(getPlayerFromPartialName(tele))
			local dim = getElementDimension(getPlayerFromPartialName(tele))
			local int = getElementInterior(getPlayerFromPartialName(tele))
			setElementInterior(occupiedCar,tonumber(int))
			setElementDimension(occupiedCar,tonumber(dim))
			setElementPosition(occupiedCar,x + 4,y,z)
			setElementInterior(player,tonumber(int))
			setElementDimension(player,tonumber(dim))
		else
			outputChatBox("You are not the driver!",player,0,255,255)
		end
	else
		local x,y,z = getElementPosition(getPlayerFromPartialName(tele))
		local dim = getElementDimension(getPlayerFromPartialName(tele))
		local int = getElementInterior(getPlayerFromPartialName(tele))
		setElementInterior(player,tonumber(int))
		setElementDimension(player,tonumber(dim))
		setElementPosition(player,x + 2,y,z)
	end
end
addCommandHandler("gc", gc)

function getPlayerFromPartialName(name)
    local name = name and name:gsub("#%x%x%x%x%x%x", ""):lower() or nil
    if name then
        for _, player in ipairs(getElementsByType("player")) do
            local name_ = getPlayerName(player):gsub("#%x%x%x%x%x%x", ""):lower()
            if name_:find(name, 1, true) then
                return player
            end
        end
    end
end
	
addEventHandler("onPlayerQuit", getRootElement(),
	function()
		local attachedElements = getAttachedElements(source)
		if attachedElements then
			for i, attachedElement in ipairs(attachedElements) do
				if getElementType(attachedElement) == "blip" then
					destroyElement(attachedElement)
				end
			end
		end
	end)
	
setTimer(function()
	for _,vhl in pairs(getElementsByType("vehicle")) do
		setVehicleFuelTankExplodable(vhl,true)
	end
end,1000,0)

addCommandHandler("getserial",function(player,cmd,otherPlayer)
	if otherPlayer then
		local account = getAccountName(getPlayerAccount(player))
		if ( isObjectInACLGroup("user."..account,aclGetGroup("Console")) or isObjectInACLGroup("user."..account,aclGetGroup("Admin")) or isObjectInACLGroup("user."..account,aclGetGroup("SuperModerator")) or isObjectInACLGroup("user."..account,aclGetGroup("Moderator"))) then
			outputChatBox(getPlayerName(getPlayerFromPartialName(otherPlayer)).."'s serial is: "..tostring(getPlayerSerial(getPlayerFromPartialName(otherPlayer))),player,255,0,0)
		end
	else
		outputChatBox(getPlayerName(player).." your serial is: "..tostring(getPlayerSerial(player)),player,255,0,0)
	end
end)

addEventHandler("onPlayerJoin",getRootElement(),function()
	local countryCode = exports.admin:getPlayerCountry(source)
	local name = "Unknown"
	if countryCode and countryNames[countryCode] then
		name = countryNames[countryCode]
	end
	setElementData(source,"Country",name)
	local count = getPlayerCount()
	local playerName = getPlayerName(source)
	outputChatBox("#00FBFF"..playerName.." #FFFFFFhas joined the game from #B2FF00"..name.." #FFFFFF(#FF00BD"..count.." Players#FFFFFF)",root,0,255,255,true)
	spawnPlayer(source,-1980.28967,884.58002,45.20313,90,1,0,0,getTeamFromName("Freeroamer"))
	setCameraMatrix(source,-1895.39758,888.87921,93.32253,-1980.28967,884.58002,45.20313,0,75)
	setElementFrozen(source,true)
end)

addEventHandler("onPlayerQuit",getRootElement(),function(qType,reason)
	local name = getPlayerName(source)
	local count = getPlayerCount() - 1
	if reason then
		outputChatBox("#00FBFF"..name.." #FFFFFFhas left the game. #B2FF00(#FFFFFF"..qType.." : "..reason.."#B2FF00) #FFFFFF(#FF00BD"..count.." Players#FFFFFF)",root,0,255,255,true)
	else
		outputChatBox("#00FBFF"..name.." #FFFFFFhas left the game. #B2FF00(#FFFFFF"..qType.."#B2FF00) #FFFFFF(#FF00BD"..count.." Players#FFFFFF)",root,0,255,255,true)
	end
end)


function setColor(player,cmd,r,g,b)
	if r and g and b then
		setElementData(player,"color",true)
		setElementData(player,"r",r)
		setElementData(player,"g",g)
		setElementData(player,"b",b)
	elseif r == "off" then
		setElementData(player,"color",false)
		outputChatBox("Name color is now off!",player,255,0,0,true)
	else
		outputChatBox("Incorrect Syntax: /namecolor <r> <g> <b> or /namecolor off to turn the color off",player,255,0,0,true)
	end
end
addCommandHandler("namecolor",setColor)

setTimer(function()
	for _,plr in pairs(getElementsByType("player")) do
		if getElementData(plr,"color") == true then
			if getElementData(plr,"r") and getElementData(plr,"g") and getElementData(plr,"b") then
				local r,g,b = getElementData(plr,"r"),getElementData(plr,"g"),getElementData(plr,"b")
				local attachedElements = getAttachedElements(plr)
				if attachedElements then
					for i,ae in pairs(attachedElements) do
						if getElementType(ae) == "blip" then
							destroyElement(ae)
						end
					end
				end
				setPlayerNametagColor(plr,r,g,b)
				createBlipAttachedTo(plr,0,1,r,g,b,255)
			else
				local r,g,b = getTeamColor(getPlayerTeam(plr))
				local attachedElements = getAttachedElements(plr)
				if attachedElements then
					for i,ae in pairs(attachedElements) do
						if getElementType(ae) == "blip" then
							destroyElement(ae)
						end
					end
				end
				setPlayerNametagColor(plr,r,g,b)
				createBlipAttachedTo(plr,0,1,r,g,b,255)
			end
		else
			local r,g,b = getTeamColor(getPlayerTeam(plr))
			local attachedElements = getAttachedElements(plr)
			if attachedElements then
				for i,ae in pairs(attachedElements) do
					if getElementType(ae) == "blip" then
						destroyElement(ae)
					end
				end
			end
			setPlayerNametagColor(plr,r,g,b)
			createBlipAttachedTo(plr,0,1,r,g,b,255)
		end
	end
end,1000,0)